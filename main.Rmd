---
title: "R Basic1"
author: "NingChen"
output:
  html_document:
    number_sections: yes
    toc: yes
---
#Chapter1 WhyR 


## R 來自世界上最專業的統計學家

<center>`r fit100('statician_10521919-655x280.jpg')`</center>

圖片來源： <http://myfootpath.com/careers/engineering-careers/statistician-careers/>

## Rstudio 界面(%%Add Picture)

- 程式碼編輯區
- 命令列區
- 其他資訊區
- 檔案系統區

## 熟悉R 和Rstudio的界面

- 了解輸入
- 了解輸出
- 中斷程式







![USALandCollect](Boston.png)

##第一次使用R不害怕


```{r}
library(MASS)
#介紹引入套件
data(Boston)
head(Boston)

```

##Boston Dataset有哪些Variables

"crim" | "犯罪率" | "dis" | "weighted mean of distances to five Boston employment centres距離上班商業中心地點的英哩數"
- | - | - | -
crim | 犯罪率 | dis | weighted mean of distances to five Boston employment centres距離上班商業中心地點的英哩數
zn | 住宅區比例 | rad | index of accessibility to radial highways.可到最近的主要高速公路網路的便利指標
indus | 工業區比例 | Tax|full-value property-tax rate per \$10,000.房屋與土地相關的 Tax 比例
chas | Charles River dummy variable | ptratio | pupil-teacher ratio by town 平均學生vs教師比例
nox | 空氣中的一氧化氮比例(ppm)nitrogen oxides concentration (parts per 10 million). | black | 1000(Bk - 0.63)^2 where Bk is the proportion of blacks by town.非洲裔人口比例
Rooms | 平均每戶的房間數目 | lstat | lower status of the population (percent).低收入戶比例
age | proportion of owner-occupied units built prior to 1940.
1940年前所建的自宅比例 | medv | median value of owner-occupied homes in \$1000s.自有住宅房價中位數


##如果我要投資...怎作？
```{r}
table(Boston$medv)
barplot(table(Boston$medv))
MEDV50=subset(Boston,Boston$medv==50)

#比較富裕區與一般波士頓區域的差距
colMeans(Boston)
colMeans(MEDV50)
rbind(colMeans(Boston),colMeans(MEDV50))
```

##哪些因素跟房價有正相關或是負相關?
```{r}
#解釋1非常正相關 -1是非常負相關
cor(Boston$medv,Boston)

barplot(cor(Boston$medv,Boston))

#??sort.int(cor(Boston$medv,Boston),index.return = TRUE)

#與房間數是正相關,與低收入戶比例負相關
```

##加上分類
```{r}
Boston$Income=cut(Boston$lstat,breaks=3)
Boston$Income

Boston$Income=cut(Boston$lstat,breaks=3,label=c("L","M","H"))

#增加等量分類


#解釋data.frame;解釋num,int,factor
table(Boston$Income)
pie(table(Boston$Income))


str(Boston)
```


#Chapter2 我們所分析的數據代表什麼意義？

## R 的資料形態分類
###Character
- 最廣泛的資料結構，可用於處理文字相關的工作，如：設定圖片的標題
- 輸入的時候利用`"`或`'`來包覆要輸入的文字

### 常用的Character處理函數
字串的剪接：`paste
```{r}
x <- "abc";y <- "dbbbe"
paste(x, y, sep=",")
```

字串的切割：`strsplit`
```{r}
strsplit(x, "b")
```

截取子字串：`substring`
```{r}
name1<-"郭雪芙"
substring(name1, 1, 1)
name2<-"金城武"
substring(name2, 1, 2)
```

## R 的數值形態

- 數值形態
    - 整數`1L`
    - 實數`1.5`

```{r, echo = TRUE}
99L;99.5
99L;99.5;99.5L
```





## 數值系統的分類


- 名目資料(nomial)
- 順序資料(ordinal)
- 區間資料(interval)
- 比例資料(ratio)

 ""|"資料衡量尺度" |"變數形態"|"特性"
 - |- |- |-
 1|"名目資料"|"質化"|"類別"
 2|"順序資料"|"質化"|"優先順序"
 3|"區間資料"|"量化"|"大小距離"
 4|"比例資料"|"量化"|"比值"

### 名目資料
數值只用於記號，"值"毫無意義的數據

* 性別
* 國家/班級



男  | 女
------------- | -------------
0  | 1

男  | 女
------------- | -------------
1  | 2


### 順序資料
數值有順序關係，但是差距沒有意義
*名次
*排序表
第一名的成績一定比第二名好,
但不代表第一名比第二名好兩倍

![一流大學補助][]

### 區間資料
有差距的概念，沒有倍數的概念。
數值有1的概念，沒有0的概念。可加減。
*溫度
*時間

### 比值資料
同時有差距和倍數的概念。
可加減乘除。
*使用者人數
*營收

 ""|"資料衡量尺度" |"變數形態"|"特性"|Hint
 - |- |- |- |-
 1|"名目資料"|"質化"|"類別"|用於記號,"值"毫無意義的數據
 2|"順序資料"|"質化"|"優先順序"|有順序關係,但是差距沒有意義
 3|"區間資料"|"量化"|"大小距離"|數值有順序關係,但是差距沒有意
 4|"比例資料"|"量化"|"比值"|同時有差距和倍數的概念
可加減乘除




###Factor
常用於處理質性變數
```{r factor-levels}
x <- c("F","M","F","F")
x
x <- factor(c("F","M","F","F"), levels=c("F","M"))
x
x <- factor(c("F","M","F","F"), levels=c("F"))
levels(x)
as.integer(x)
```
c(1,2,3)


### Logical 
產生自比較，或是使用`T`、`TRUE`、`F`或`FALSE`輸入
```{r logical-demo1}
x <- 1
x < 2
x <= 1
```

### Integer and Numeric 

`+`

```{r integer-plus}
1 + 2
```

`-`

```{r integer-minus}
1 - 2
```

`*`

```{r integer-times}
1 * 2
```

`/`

```{r integer-divide}
1L / 2L
```

### 向量式資料結構
Recape that x=1 or x<1, how to input more than lenth=1 ?
x=1,2(Failed) /Translate


我要輸入12月份
```{r vector}
Month1=c(1,2,3,4,5,6,7,8,9,10,11,12)
length(Month1)
Month2=1:12
length(Month2)

```

```{r, echo=TRUE}
1:3
c(1, 2, 3) + 1
1:3 * 2
```

- 利用`c`和建立向量
- 利用`:`建立序列
- 運算是向量式的

<center>`r fig("vectorize-plus-before.png", 50)`</center>
$$\Downarrow$$
<center>`r fig("vectorize-plus-after.png", 50)`</center>

--- &vcenter .largecontent

## 小挑戰

### 請利用`+`、`-`、`*`或`/`來回答：

```r
# 社會服務業自民國87至民國91年的年度用電量（度）
power1 <- c(6097059332, 6425887925, 6982579022, 7323992602.53436, 7954239517) 
# 製造業自民國87至民國91年的年度用電量（度）
power2 <- c(59090445718, 61981666330, 67378329131, 66127460204.6482, 69696372914.6949) 
```
- 計算各年度製造業的用電量是社會服務業的多少倍?

*** =pnotes

`power2 / power1`

--- .segue .dark


### 同質性向量 Vector 
Character > Numeric > Integer > Logical
```{r homogenous}
x <- c(1L, 2.0, "3")
class(x)
x
```
* 改一個，全部就都變了

###異質性資料 List 
```{r}
x<-list(1L,2,"3")
```
*連函數都吃
```{r}
x<-list(1L,2,"3",mean)
```
### 異質性資料 dataframe
View(Boston)

Delete columns and rows
```
mynewdata <- mydata1[!is.na(mydata1[,2]),-c(4:5)]
mynewdata[65:70,]
```
### subset
Combine objects by rows: rbind
UK2000 <- subset(mynewdata, Country == "UK"
& date > as.Date("2000-01-01"))
Germany2000 <- subset(mynewdata, Country == "Germany"
& date > as.Date("2000-01-01"))
identical(names(UK2000),names(Germany2000))
* [1] TRUE
###rbind
rbind(UK2000,Germany2000)
###cbind
Combine objects by columns: cbind
E2000 <- cbind(UK2000[,1:2],Germany2000[,2])
names(E2000) <- c("date","UK","Germany")
E2000

###Merge
Merge two data frames: merge
China <- subset(mynewdata,Country == "China",
select=c(date:unem_rate))
names(China)[2] <- "China"
merge(E2000,China,by="date")


### 轉換資料結構 
`as`

- `as.character`
- `as.logical`
- `as.integer`
- `as.numeric`

```{r as}
as.numeric("2")
as.integer("a")
```

```{r as.character, echo = TRUE}
x <- c(1, 2, 3, 2, 3, 2, 1)
as.character(x) # 字串
factor(x) # 類別
```

## 資料形態的轉換 - 將數值轉換為類別

### 分級

```{r cut, echo = TRUE}
x <- c(75, 81, 82, 76, 91, 92)
cut(x, breaks = c(70, 80, 90, 100))
```

## 資料形態的轉換 - 將字串轉換為數值

### 直接轉換

```{r as.numeric, echo = TRUE}
x <- c("1", "2", "3", "2", "a")
as.numeric(x)
```

- `NA`代表Not available，代表著**missing value**

## 資料形態的轉換 - 資料清理

### 民國80年至82年的國民生產毛額

<pre><code style="text-align: center;">
百萬元
5,023,763
5,614,679
6,205,338
</code></pre>

```{r gdp1, echo = TRUE}
gdp <- c("5,023,763", "5,614,679", "6,205,338")
as.numeric(gsub(",", "", gdp))
```

請問這份「各年度產業別用電資料」的各欄類別為何？

```{r power.type, echo = FALSE, results='asis'}
data(power, package = "DSP2014R")
kable(head(power))
```

## `summary` 指令

```{r summary, echo = TRUE}
data(power, package = "DSP2014R")
summary(power)
```
- 根據資料形態的不同，函數的輸出結果也會不同

## 資料的讀取
## 讀取整理過後的表格檔案

```
"產業代號（第六版）","產業名稱","年度（民國）","用電量（度）"
"","農藝及園藝",87,113584956
"011","農藝及園藝",88,122010866
"011","農藝及園藝",89,139061996
"011","農藝及園藝",90,143103985.905191
```

```{r read.table, echo = TRUE}
path <- system.file("opendata/power/power.csv", package = "DSP2014R");path
src <- readLines(con = path, n = 5)
power <- read.table(file = path, header = TRUE, sep = ",");head(power)
```

- 注意：有些參數是字串，有些參數是數值
- TRUE/FALSE代表布林值


    
    



```{r}
str(Boston)
```
*眾數、中位數、四分位差和算數平均數能用於哪些資料形態*


## 資料的選取

--- &vcenter .largecontent

## 布林運算

- `>` `<` `>=` `<=` `==` `!=`

```{r boolean, echo = TRUE}
1 > 2;1 <= 2
"A" == "A";"A" != "A"
```

--- 

## 向量的選取

### 坐標

```{r index, echo = TRUE}
x <- 1:5; x[2:3]
```

### 布林

```{r boolean_selection, echo = TRUE}
x <- 1:5; x > 3; x[x > 3]
```

--- &vcenter .largecontent

## 多重條件

### 且：`&`

`布林運算結果1 & 布林運算結果1`

### 或：`|`

`布林運算結果1 | 布林運算結果1`

--- &vcenter .largecontent

## 小挑戰

```{r exercise_selection, eval = FALSE, echo = TRUE}
# 社會服務業自民國87至民國91年的年度用電量（度）
power1 <- c(6097059332, 6425887925, 6982579022, 7323992602.53436, 7954239517) 
# 製造業自民國87至民國91年的年度用電量（度）
power2 <- c(59090445718, 61981666330, 67378329131, 66127460204.6482, 69696372914.6949) 
```

- 運用index從`power1`中選取第88年和第90年的年度用電量。結果應該為：
    ```{r exercise_selection_ans1, echo = FALSE}
    c(6097059332, 6425887925, 6982579022, 7323992602.53436, 7954239517)[c(2,4)]
    ```
- 運用布林運算自`power2`中選出，製造業超過社會服務業9.5倍的用電年度的用電量。結果應該為：
    ```{r exercise_selection_ans2, echo = FALSE}
    power1 <- c(6097059332, 6425887925, 6982579022, 7323992602.53436, 7954239517) 
    power2 <- c(59090445718, 61981666330, 67378329131, 66127460204.6482, 69696372914.6949) 
    power2[power2 / power1 > 9.5]
    ```

--- &vcenter .largecontent

## 表格的選取

```{r select_table, echo = TRUE}
data(power, package = "DSP2014R")
power[1, 2]
```

`r fig("table_selection.png", 100)`

--- &vcenter .largecontent

## 欄的選取

```{r select_column, echo = TRUE}
head(power)
head(power[["name"]]) # head(power$name)
```

--- &vcenter .largecontent

## 範例

### 選取資訊服務業的歷年用電資料

1. 自`power`選取`name`
2. 利用布林運算，把1.的結果和`"資訊服務業"`比較
3. 利用2.的結果選取power的列

```{r select_row_example, echo = TRUE}
x1 <- power[["name"]] # power$name
x2 <- x1 == "資訊服務業"
x3 <- power[x2,]
head(x3)
```

---

## 小挑戰

### 請選取「資訊服務業」第89年度的用電量

1. 自`power`選取`name`
2. 利用布林運算，把1.的結果和`"資訊服務業"`比較
3. 自`power`選取`year`
4. 利用布林運算，把3.的結果和89比較
5. 利用布林運算，取得同時滿足2.和4.的結果（且）
6. 利用5.的結果選取power的列

*** =pnotes

```{r, echo = TRUE, eval = FALSE}
x1 <- power[["name"]]
x2 <- x1 == "資訊服務業"
x3 <- power[["year"]]
x4 <- x3 == 89
x5 <- x2 & x4
x6 <- power[x5,]
x6
```


## 探索一個變數

### 量化數據

- 敘述統計量：`mean`、`sd`、`median`、`quantile`
- 繪圖看分佈：`density`

### 質化數據

- 分佈表格：`table`

## 探索一個量化變數

### 挑戰：學習`sd`的用法

## 探索一個量化變數

### 挑戰：選取<b>出版業合計</b>的歷年用電消耗量資料

### 範例：使用`mean`求<b>出版業合計</b>的歷年用電平均值

### 挑戰：使用`sd`求<b>出版業合計</b>的歷年用電標準差

1. 選取<b>出版業合計</b>的歷年用電消耗量資料
2. 在`mean`中利用1.的結果
3. 在`sd`中利用1.的結果

## 探索一個質化變數

1. 選取電力資料中所有的標籤，存成`label`變數
2. 學習`table`的用法
    - `?table`
    - `example(table)`
3. 利用`table`觀察標籤的個數

